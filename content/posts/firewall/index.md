+++
date = '2025-02-04T15:30:19+02:00'
draft = false
hidden = false
title = 'Какво е защитна стена и какво трябва да знаем за нея?'
tags = ['firewall','tcp','udp','ports']
summary = 'Основи на компютърните мрежи. Защитна стена.'
+++
<span>{{< youtube dpw4RkI9054 >}}</span>

Днес се потапяме в нещо, което е от решаващо значение за поддържането на безопасността на вашия компютър, но често се пренебрегва – защитната стена на Windows. До края на тaзи статия ще знаете какво представлява, как работи и как да я използвате ефективно.

## Какво е защитна стена?

Defender Firewall (защитна стена) е интегрирана система за защита, която е част от операционната система Windows. Тя служи за контролиране и управление на мрежовия трафик, който влиза и излиза от компютъра. Основната му цел е да осигури защита срещу нежелан достъп и зловредни атаки чрез блокиране на нерегламентиран трафик и разрешаване само на упълномощени връзки.

[![](firewall1.png "{{< icon "link" >}}*фиг. 1*")](firewall1.png)

## Основни функции на защитната стена

- **Филтриране на мрежовия трафик**: Позволява или блокира достъпа до интернет и мрежови ресурси въз основа на зададени правила.
- **Контрол на приложенията**: Може да ограничи достъпа на конкретни приложения до интернет или мрежата.
- **Предотвратяване на неупълномощен достъп**: Защитава компютъра от хакери, вируси и друг зловреден софтуер, който може да се опита да осъществи достъп.
- **Персонализиране**: Потребителите могат ръчно да създават и управляват правила за специфични програми, портове или мрежови протоколи.
- **Локални и публични мрежи**: Защитната стена автоматично адаптира настройките си в зависимост от типа на мрежата (например домейн, частна или публична).

Защитната стена е важен компонент за сигурността на вашата система и се препоръчва винаги да бъде включена. Освен това, в Windows тя работи в синхрон с други защитни системи, като Windows Defender, за да осигури цялостна защита.

## Принцип на работа

Защитната стена функционира с комплект предварително създадени правила (входящи и изходящи). От Microsoft са подготвили 3 комплекта от правила в зависимост от средата (мрежата), в която се използва компютърът *(фиг. 3)* - **domain**, **private** и **public** network.

[![](firewall2.png "{{< icon "link" >}}*фиг. 2*")](firewall2.png)

> **ВАЖНО!** Ако имате лаптоп и го използвате на различни места (работа, дом, кафе) е наложително да превключвате режимите на защитната стена *(фиг. 3)*.

Най-бързият начин за превключване на типа на мрежата в Windows (между **domain**, **private** и **public**) зависи от това дали искате да го направите чрез графичния интерфейс или чрез команден ред. Ето двата метода:

### Метод 1: Чрез графичния интерфейс

1. Отваряне на настройките за мрежата:
   - Натиснете **Win + I**, за да отворите „Settings“.
   - Отидете на **Network & Internet**.
   - Изберете активната си мрежа (например „Ethernet“ или „Wi-Fi“).

2. Промяна на типа мрежа:
   - Ако сте в Wi-Fi мрежа, кликнете върху името на мрежата под „Wi-Fi“.
   - Ако сте в Ethernet мрежа, кликнете върху „Ethernet“.
   - Изберете „Private“ или „Public“ според вашите предпочитания.

> **Забележка:** „Domain“ е автоматично зададено от Windows, ако компютърът е свързан към Active Directory.

### Метод 2: Чрез PowerShell

Ако предпочитате команден ред, използвайте PowerShell, за да промените типа на мрежата:

1. Отворете PowerShell с администраторски права:
   - Натиснете **Win + X** и изберете **Windows PowerShell (Admin)**.

2. **Проверете текущия тип мрежа:**

    ```powershell
    Get-NetConnectionProfile
    ```

3. **Променете типа на мрежата:**

   - За да смените на **Private**:

   ```powershell
   Set-NetConnectionProfile -Name "Име на мрежата" -NetworkCategory Private
   ```

   - За да смените на **Public**:

   ```powershell
   Set-NetConnectionProfile -Name "Име на мрежата" -NetworkCategory Public
   ```

> **Забележка:** Заменете `Име на мрежата` с името на активната мрежа, което сте получили от `Get-NetConnectionProfile`.
> **Препоръка:** Ако често превключвате между типовете мрежи, препоръчваме да използвате **PowerShell**, тъй като това е най-бързият и ефективен начин без нужда от отваряне на много менюта.

[![](firewall4.png "{{< icon "link" >}}*фиг. 3*")](firewall4.png)

## Работа със защитната стена

Когато стартираме програма за първи път на компютър с Windows и тя изисква достъп до интернет, Windows Firewall автоматично засича опита за свързване. На екрана се появява изскачащ прозорец с въпрос дали да позволим на програмата достъп до мрежата.

Този прозорец дава възможност да изберем дали достъпът да бъде разрешен само за **частни мрежи** (например домашна или служебна мрежа) или за **публични мрежи** (като Wi-Fi в кафене). Ако изберем „Разреши достъп“ (Allow Access), програмата получава необходимите права за интернет връзка. Ако откажем достъп, програмата ще бъде блокирана от Firewall и няма да може да използва интернет.

Този механизъм служи за защита на компютъра от потенциално опасен софтуер и неоторизиран достъп до мрежата.

[![](firewall3.png "{{< icon "link" >}}*фиг. 4*")](firewall3.png)

Това е и първият ни досег със защитната стена, но да разгледаме как можем да променим настройките за вече настроена програма или да добавим правило за програма, която все още не сме стартирали.

### Методи за достигане до настройките на Windows Firewall

1. **Чрез търсачката в Start менюто**:
   - Натиснете бутона **Start** (или клавиша Windows).
   - Въведете "Windows Firewall" или "Firewall & network protection".
   - Кликнете върху резултата „Firewall & network protection“ (в новите версии на Windows) или „Windows Defender Firewall“ (в по-старите версии).
2. **Чрез Control Panel (Контролен панел)**:
   - Натиснете клавишната комбинация **Windows + R**, въведете `control` и натиснете Enter.
   - В Control Panel изберете **System and Security** → **Windows Defender Firewall**.
3. **Чрез приложението Settings (Настройки)**:
   - Натиснете **Windows + I**, за да отворите приложението Settings.
   - Отидете в **Update & Security** → **Windows Security** → **Firewall & network protection**.
4. **Чрез диалоговия прозорец Run (Стартиране)**:
   - Натиснете **Windows + R**.
   - Въведете `firewall.cpl` и натиснете Enter. Това ще ви отведе директно до настройките на Windows Firewall.
5. **Чрез иконата за защита в системния трей**:
   - Кликнете върху иконата на щит (Windows Security) в системния трей (до часовника).
   - Изберете **Firewall & network protection** от менюто.

Всеки от тези методи предоставя бърз достъп до настройките на Windows Firewall за конфигуриране или преглед.

[![](firewall4.png "{{< icon "link" >}}*фиг. 5*")](firewall4.png)

### Добавяне на нова програма или редактиране на добавена такава

Опцията „Allow an app through firewall“ позволява на потребителя да даде разрешение на конкретни приложения или програми да комуникират през защитната стена (Firewall). Това е полезно, когато дадено приложение се нуждае от достъп до интернет или локалната мрежа, но е блокирано от защитната стена.

[![](firewall5.png "{{< icon "link" >}}*фиг. 6*")](firewall5.png)

#### Как да използваме функцията

1. **Достъп до "Allow an app through firewall":**
   - Отворете **Control Panel** → **System and Security** → **Windows Defender Firewall**.
   - Вляво кликнете върху **Allow an app or feature through Windows Defender Firewall**.
   - В Windows 11 можете също да потърсите тази опция чрез търсачката в **Start** менюто.
2. **Преглед на разрешените приложения:**
   - Ще се отвори списък с всички приложения и функции, които имат разрешение за достъп през защитната стена.
   - Виждате две колони: **Private** (Частни мрежи) и **Public** (Публични мрежи), които указват за кои типове мрежи е позволен достъпът.
3. **Промяна на настройките:**
   - Кликнете върху бутона **Change settings** (Изменение на настройките), за да получите права за редактиране. Това изисква администраторски достъп.
   - Поставете или премахнете отметки за конкретно приложение:
     - **Private** – Позволява достъп през домашни или служебни мрежи.
     - **Public** – Позволява достъп през обществени мрежи, като например Wi-Fi в кафене.
4. **Добавяне на ново приложение:**
   - Ако програмата, която искате да разрешите, не е в списъка, натиснете бутона **Allow another app...**.
   - В изскачащия прозорец кликнете върху **Browse...**, намерете изпълнимия файл на приложението (.exe) и натиснете **Add**.
   - След като добавите приложението, изберете за кои мрежи да бъде разрешен достъпът (Private и/или Public).
5. **Запазване на промените:**
   - След като направите нужните настройки, натиснете **OK**, за да ги запазите.

#### Препоръки

- **Внимавайте какво разрешавате:** Позволявайте достъп само на приложения, които познавате и на които имате доверие.
- **Публични мрежи:** Бъдете особено внимателни с разрешаването на приложения за публични мрежи, тъй като това може да създаде риск за сигурността.
- **Отмяна на достъп:** Ако забележите нежелана активност, върнете се в списъка и премахнете отметките за приложението.

Тази функция е ключова за персонализиране на достъпа на приложенията до интернет и мрежите, като същевременно поддържа високо ниво на сигурност.

### Работа с "Windows Defender Firewall with Advanced Security"

„Windows Defender Firewall with Advanced Security“ е усъвършенстван инструмент за управление на настройките на защитната стена. Той позволява прецизно конфигуриране на входящите и изходящите правила за трафик, както и допълнителни настройки за защита на мрежата. Този инструмент е подходящ за по-напреднали потребители и системни администратори.

[![](firewall6.png "{{< icon "link" >}}*фиг. 7*")](firewall6.png)

#### Как да достъпите "Advanced Security"

1. **Чрез търсачката в Start менюто:**
   - Въведете „Windows Defender Firewall with Advanced Security“ и изберете опцията от резултатите.
2. **Чрез Control Panel:**
   - Отидете в **Control Panel** → **System and Security** → **Windows Defender Firewall**.
   - Вляво кликнете върху **Advanced settings**.
3. **Чрез Run (Стартиране):**
   - Натиснете **Windows + R**, въведете `wf.msc`, и натиснете Enter.

#### Основни компоненти и функции

1. **Inbound Rules (Входящи правила):**
   Тези правила контролират входящия трафик към вашата система. Например, можете да разрешите или блокирате достъп до конкретни портове, IP адреси или приложения.
   - **Пример:** Разрешаване на входящия трафик за уеб сървър на порт 80.
2. **Outbound Rules (Изходящи правила):**
   Те управляват изходящия трафик от вашата система. Това е полезно, ако искате да ограничите дадено приложение да изпраща данни в интернет.
   - **Пример:** Блокиране на дадена програма да осъществява интернет връзка.

[![](firewall7.png "{{< icon "link" >}}*фиг. 8*")](firewall7.png)

3. **Connection Security Rules (Правила за сигурност на връзката):**
   Тези правила се използват за защита на мрежовите връзки чрез методи като IPsec (шифроване и удостоверяване). Това е подходящо за създаване на защитени комуникации между устройства.
   - **Пример:** Настройване на криптирана връзка между два сървъра.
4. **Monitoring (Мониторинг):**
   Тази секция ви позволява да преглеждате активните правила, текущи връзки и активност на защитната стена в реално време.

#### Създаване на ново правило

1. **Отидете в секцията „Inbound Rules“ или „Outbound Rules“.**
2. Кликнете върху **New Rule...** в дясната част на прозореца.
3. Изберете типа на правилото:
   - **Program:** Ограничете или разрешете достъп за конкретна програма.
   - **Port:** Контролирайте трафик през определен порт или протокол (TCP/UDP).
   - **Predefined:** Изберете предварително дефинирано правило за често срещани услуги (напр. File and Printer Sharing).
   - **Custom:** Създайте персонализирано правило за конкретни параметри като IP адреси, портове, протоколи и др.
4. Следвайте стъпките в съветника, за да настроите правилото.
5. Завършете процеса, като натиснете **Finish**.

#### Примери за случаи на употреба

1. **Блокиране на програма:**
   - Създайте **Outbound Rule**, изберете програмата и задайте „Block the connection“.

2. **Разрешаване на достъп до порт 443:**
   - Създайте **Inbound Rule**, изберете „Port“, задайте TCP порт 443 и разрешете връзката.

3. **Ограничаване на IP адреси:**
   - Създайте **Custom Rule**, задайте конкретни IP адреси в секцията „Scope“.

#### Препоръки при създаването на правила

- **Бъдете внимателни:** Не блокирайте важни системни услуги, тъй като това може да доведе до проблеми с мрежовата свързаност.
- **Тествайте промените:** След като създадете или редактирате правило, проверете дали мрежовите функции работят според очакванията.
- **Използвайте IPsec за защита:** За чувствителни данни настройте правила с криптиране за връзките.

„Windows Defender Firewall with Advanced Security“ е мощен инструмент, който осигурява по-добър контрол върху мрежовия трафик и защита на вашата система.

### Възстановяване на настройките на Windows Firewall

Ако нещо се обърка с настройките на защитната стена (Windows Firewall), можете лесно да ги върнете към първоначалното им състояние. Това ще премахне всички персонализирани правила и ще възстанови фабричните настройки.

#### Метод 1: Чрез графичния интерфейс на Windows Firewall

1. **Отворете Windows Firewall:**
   - Отидете в **Control Panel** → **System and Security** → **Windows Defender Firewall**.
   - Вляво изберете **Restore defaults** (Възстановяване на настройките по подразбиране).

2. **Възстановяване на настройките:**
   - Кликнете върху бутона **Restore defaults**.
   - Ще се появи предупреждение, че всички съществуващи правила ще бъдат премахнати.
   - Потвърдете действието, като натиснете **Yes**.

#### Метод 2: Чрез „Advanced Security“

1. **Отворете "Windows Defender Firewall with Advanced Security":**
   - Натиснете **Windows + R**, въведете `wf.msc` и натиснете Enter.

2. **Възстановяване на настройките:**
   - В прозореца вдясно, изберете **Restore Default Policy**.
   - Потвърдете действието, когато се появи предупредително съобщение.

#### Метод 3: Чрез PowerShell

1. **Отворете PowerShell като администратор:**
   - Натиснете **Windows + X** и изберете **Windows PowerShell (Admin)**.

2. **Изпълнете командата:**

   ```powershell
   New-NetFirewallRule -All -Action Allow
   Remove-NetFirewallRule -All
   ```

   - Това ще изтрие всички съществуващи правила и ще създаде основен набор от разрешения.

#### Какво се случва след възстановяване

- Всички персонализирани входящи и изходящи правила ще бъдат изтрити.
- Настройките за свързаност ще се върнат към фабричните стойности.
- Програмите и услугите ще трябва отново да поискат достъп през защитната стена, когато е необходимо.

#### Препоръки след възстановяване

1. **Проверете важните приложения:** Уверете се, че основните програми, които използват мрежа, имат разрешение за достъп.
2. **Създайте резервно копие:** Ако настройвате правила често, използвайте опцията за експортиране на настройки, преди да направите значителни промени.
3. **Актуализирайте настройките според нуждите:** След възстановяването, добавете само необходимите изключения и правила за сигурност.

Възстановяването на настройките на Windows Firewall е бърз и ефективен начин да решите проблеми, свързани със свързаността или неправилна конфигурация.
